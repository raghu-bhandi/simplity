<?xml version="1.0" encoding="UTF-8"?>
<service dbAccessType="readWrite" description=""
	executeInBackground="true" moduleName="submission" name="updatenomination"
	xmlns="http://www.simplity.org/schema">
	<inputData attachmentFields="filekey">
		<inputFields>
			<inputField dataType="_text" name="nominationId" />
			<inputField dataType="_text" name="filekey" />
			<inputField dataType="_text" name="filename" />
			<inputField dataType="_text" name="filetype" />
			<inputField dataType="_text" name="filesize" />
			<inputField dataType="_text" name="selectedCategory" />
			<inputField dataType="_text" name="summary" />
			<inputField dataType="_text" name="nomination" />
			<inputField dataType="_text" name="sponsorMailNickname" />
			<inputField dataType="_text" name="sponsorMail" />
			<inputField dataType="_text" name="submitterMailNickname" />
			<inputField dataType="_text" name="submitterMail" />
			<inputField dataType="_text" name="sponsorname" />
			<inputField dataType="_text" name="sponsornumber" />
			<inputField dataType="_text" name="status" />
			<inputField dataType="_boolean" name="email" />
			<inputField dataType="_text" name="categoryNickname" />
		</inputFields>
		<inputRecords>
			<inputRecord recordName="nomination.members" sheetName="members" />
		</inputRecords>
	</inputData>
	<actions>
		<setValue fieldName="sponsorMail" expression="lowercase(sponsorMail)"></setValue>
		<setValue fieldName="sponsorMailNickname" expression="lowercase(sponsorMailNickname)"></setValue>
		<setValue fieldName="alias" fieldValue="null"></setValue>
		<setValue fieldName="aliasRequired" expression="statuscheck(status)"></setValue>
		<readWithSql sqlName="submission.categorycount"
			actionName="countAction" executeOnCondition="aliasRequired" />
		<log names="aliasRequired,count" actionName="logAction" />
		<setValue fieldName="alias" expression="aliasname(categoryNickname,count)"
			executeOnCondition="aliasRequired" />
		<setValue fieldName="filename" fieldValue="$alias"
			executeOnCondition="aliasRequired" />
		<save saveAction="modify" recordName="nomination.nomination"
			actionName="modifyAction">
			<childRecords>
				<relatedRecord sheetName="members" recordName="nomination.members" />
			</childRecords>
		</save>
		<subService serviceName="submission.mailer"
			executeOnCondition="email" />
		<read recordName="nomination.nomination" outputSheetName="nominations">
			<childRecords>
				<relatedRecord sheetName="members" recordName="nomination.members"/>
			</childRecords>
		</read>
	</actions>
	<outputData attachmentColumns="nominations.filekey">
		<outputRecords>
			<outputRecord sheetName="nominations" />
			<outputRecord sheetName="members" parentSheetName="nominations" linkColumnInParentSheet="nominationId" linkColumnInThisSheet="nominationId"/>
		</outputRecords>
	</outputData>
</service>