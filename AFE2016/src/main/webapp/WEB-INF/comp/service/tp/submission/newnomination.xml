<?xml version="1.0" encoding="UTF-8"?>
<service
	dbAccessType="readWrite"
	description=""
	executeInBackground="true"
	moduleName="submission"
	name="newnomination"
	xmlns="http://www.simplity.org/schema"
>
<inputData attachmentFields="filekey">
<inputFields>				
	<inputField dataType="_text" name="filekey"/>
	<inputField dataType="fileName" name="filename"/>
	<inputField dataType="_text" name="filetype"/>
	<inputField dataType="_text" name="filesize"/>
	<inputField dataType="_text" name="selectedCategory"/>
	<inputField dataType="executiveSummary" name="summary"/>
	<inputField dataType="nominationTitle" name="nomination"/>
	<inputField dataType="_text" name="sponsorMailNickname"/>
	<inputField dataType="_text" name="sponsorMail"/>
	<inputField dataType="_text" name="sponsorname"/>
	<inputField dataType="_text" name="sponsornumber"/>
	<inputField dataType="_text" name="status"/>
	<inputField dataType="_boolean" name="email"/>
</inputFields>
<inputRecords>
	<inputRecord recordName="nomination.members" sheetName="members"/>
</inputRecords>
</inputData>	
	<actions>			
		<copyUserId fieldName="copyuserid" actionName="copyUserIdAction" description="Copy user id from context"/>
		
		<setValue fieldName="lookupurl" fieldValue="http://sparsh-ic:8080/LDAPLookup/a._s?_serviceName=lookup.ldaplookup&amp;mailidpart="></setValue>
		<setValue fieldName="param" fieldValue="mail"></setValue>	
		
		<setValue fieldName="submitterMail" expression="ldap(lookupurl,copyuserid,param)"></setValue>	
		<setValue fieldName="submitterMail" expression="lowercase(submitterMail)"></setValue>	
		<setValue fieldName="submitterMailNickname" expression="lowercase(copyuserid)"></setValue>

		<setValue fieldName="sponsorMail" expression="lowercase(sponsorMail)"></setValue>
		<setValue fieldName="sponsorMailNickname" expression="lowercase(sponsorMailNickname)"></setValue>
		<setValue fieldName="alias" fieldValue="null"></setValue>
		<save saveAction="save" recordName="nomination.nomination">
			<childRecords>
				<relatedRecord sheetName="members" recordName="nomination.members"/>
			</childRecords>
		</save>
		<subService serviceName="submission.mailer" executeOnCondition="email"/>
		<read recordName="nomination.nomination" outputSheetName="nominations"></read>
	</actions>
	<outputData fieldNames="nominationId,submitterMail,submitterMailNickname"></outputData>
</service>